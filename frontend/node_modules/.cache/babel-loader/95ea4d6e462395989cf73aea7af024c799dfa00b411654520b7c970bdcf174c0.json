{"ast":null,"code":"import { mapGetters } from 'vuex';\nexport default {\n  name: 'PatientPayment',\n  data() {\n    return {\n      doctorList: [],\n      unpaidAppointments: [],\n      paidAppointments: [],\n      paymentDialogVisible: false,\n      invoiceDialogVisible: false,\n      currentPayment: null,\n      currentInvoice: null,\n      paymentMethod: 'wechat',\n      paymentLoading: false,\n      treatmentFees: {\n        '普通检查': 100,\n        '洗牙': 200,\n        '补牙': 500,\n        '拔牙': 300,\n        '正牙': 5000,\n        '种植牙': 8000\n      }\n    };\n  },\n  computed: {\n    ...mapGetters(['currentUser'])\n  },\n  mounted() {\n    this.fetchDoctors();\n    this.fetchAppointments();\n  },\n  methods: {\n    // 获取医生列表\n    fetchDoctors() {\n      this.$http.get('/user/doctors').then(response => {\n        if (response.data.code === 200) {\n          this.doctorList = response.data.data;\n        }\n      }).catch(error => {\n        console.error('获取医生列表错误:', error);\n      });\n    },\n    // 获取预约列表\n    fetchAppointments() {\n      this.$http.get(`/appointment/patient/${this.currentUser.id}`).then(response => {\n        if (response.data.code === 200) {\n          const appointments = response.data.data || [];\n\n          // 分类预约：已支付和未支付\n          this.unpaidAppointments = appointments.filter(item => item.paymentStatus === 0 && item.status !== 3).map(item => {\n            return {\n              ...item,\n              doctorName: item.doctorName || '医生' + item.doctorId,\n              // 实际应该从后端获取医生名称\n              paymentAmount: item.orderAmount || this.getFeeByTreatment(item.treatmentItem)\n            };\n          });\n          this.paidAppointments = appointments.filter(item => item.paymentStatus === 1).map(item => {\n            return {\n              ...item,\n              doctorName: item.doctorName || '医生' + item.doctorId,\n              paymentAmount: item.orderAmount || this.getFeeByTreatment(item.treatmentItem)\n            };\n          });\n        }\n      }).catch(error => {\n        console.error('获取预约记录失败:', error);\n        this.$message.error('获取预约记录失败，请稍后重试');\n      });\n    },\n    // 根据治疗项目获取费用\n    getFeeByTreatment(treatment) {\n      return this.treatmentFees[treatment] || 300; // 默认300元\n    },\n    // 立即支付\n    payNow(appointment) {\n      this.currentPayment = {\n        ...appointment\n      };\n      this.paymentMethod = 'wechat';\n      this.paymentDialogVisible = true;\n    },\n    // 确认支付\n    confirmPayment() {\n      if (!this.currentPayment) return;\n      this.paymentLoading = true;\n\n      // 计算支付金额\n      const amount = this.currentPayment.paymentAmount || this.getFeeByTreatment(this.currentPayment.treatmentItem);\n\n      // 模拟支付请求\n      setTimeout(() => {\n        this.$http.put(`/appointment/${this.currentPayment.id}/pay?amount=${amount}`).then(response => {\n          if (response.data.code === 200) {\n            this.$message.success('支付成功');\n            this.paymentDialogVisible = false;\n\n            // 在前端更新当前支付对象的状态，避免刷新\n            const updatedAppointment = response.data.data || this.currentPayment;\n            updatedAppointment.paymentStatus = 1;\n            updatedAppointment.paymentTime = new Date();\n\n            // 从未支付列表中移除\n            const index = this.unpaidAppointments.findIndex(item => item.id === this.currentPayment.id);\n            if (index !== -1) {\n              this.unpaidAppointments.splice(index, 1);\n            }\n\n            // 添加到已支付列表\n            this.paidAppointments.unshift({\n              ...updatedAppointment,\n              doctorName: this.currentPayment.doctorName,\n              paymentAmount: amount\n            });\n\n            // 刷新支付记录\n            this.fetchAppointments();\n          } else {\n            this.$message.error(response.data.message || '支付失败');\n          }\n        }).catch(error => {\n          console.error('支付错误:', error);\n          this.$message.error('支付失败，请稍后重试');\n        }).finally(() => {\n          this.paymentLoading = false;\n        });\n      }, 1500); // 模拟网络延迟\n    },\n    // 查看发票\n    viewInvoice(appointment) {\n      this.currentInvoice = {\n        ...appointment\n      };\n      this.invoiceDialogVisible = true;\n    },\n    // 打印发票\n    printInvoice() {\n      this.$message.success('打印功能已触发，请检查打印机状态');\n\n      // 这里可以实现实际的打印功能，例如使用window.print()或生成PDF\n      const printWindow = window.open('', '_blank');\n      const invoice = this.currentInvoice;\n      const html = `\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <title>电子发票</title>\n            <style>\n              body { font-family: Arial, sans-serif; margin: 20px; }\n              .invoice-header { text-align: center; margin-bottom: 30px; }\n              .invoice-header h2 { margin-bottom: 5px; }\n              .invoice-info { margin-bottom: 30px; }\n              .invoice-row { display: flex; margin-bottom: 10px; }\n              .invoice-label { width: 150px; font-weight: bold; }\n              .invoice-value { flex: 1; }\n              .invoice-table { margin-bottom: 30px; }\n              .invoice-table table { width: 100%; border-collapse: collapse; }\n              .invoice-table th, .invoice-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n              .invoice-table th { background-color: #f2f2f2; }\n              .invoice-table tfoot td { font-weight: bold; }\n              .text-right { text-align: right; }\n              .invoice-footer { margin-top: 50px; }\n              .invoice-stamp { margin-top: 30px; text-align: right; border: 2px dashed #f00; display: inline-block; padding: 10px 20px; color: #f00; font-weight: bold; float: right; }\n            </style>\n          </head>\n          <body>\n            <div class=\"invoice-header\">\n              <h2>电子发票</h2>\n              <p>发票编号：INV${invoice.id}${Math.floor(Math.random() * 10000).toString().padStart(4, '0')}</p>\n            </div>\n            \n            <div class=\"invoice-info\">\n              <div class=\"invoice-row\">\n                <div class=\"invoice-label\">患者姓名：</div>\n                <div class=\"invoice-value\">${this.currentUser.realName}</div>\n              </div>\n              <div class=\"invoice-row\">\n                <div class=\"invoice-label\">就诊项目：</div>\n                <div class=\"invoice-value\">${invoice.treatmentItem}</div>\n              </div>\n              <div class=\"invoice-row\">\n                <div class=\"invoice-label\">就诊医生：</div>\n                <div class=\"invoice-value\">${invoice.doctorName}</div>\n              </div>\n              <div class=\"invoice-row\">\n                <div class=\"invoice-label\">预约时间：</div>\n                <div class=\"invoice-value\">${invoice.appointmentDate} ${invoice.appointmentTime}</div>\n              </div>\n              <div class=\"invoice-row\">\n                <div class=\"invoice-label\">开票日期：</div>\n                <div class=\"invoice-value\">${this.formatDate(invoice.paymentTime)}</div>\n              </div>\n            </div>\n            \n            <div class=\"invoice-table\">\n              <table>\n                <thead>\n                  <tr>\n                    <th>项目</th>\n                    <th>数量</th>\n                    <th>单价(元)</th>\n                    <th>金额(元)</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr>\n                    <td>${invoice.treatmentItem}</td>\n                    <td>1</td>\n                    <td>${invoice.paymentAmount}</td>\n                    <td>${invoice.paymentAmount}</td>\n                  </tr>\n                </tbody>\n                <tfoot>\n                  <tr>\n                    <td colspan=\"3\" class=\"text-right\">合计金额：</td>\n                    <td>${invoice.paymentAmount}</td>\n                  </tr>\n                  <tr>\n                    <td colspan=\"3\" class=\"text-right\">实收金额：</td>\n                    <td>${invoice.paymentAmount}</td>\n                  </tr>\n                </tfoot>\n              </table>\n            </div>\n            \n            <div class=\"invoice-footer\">\n              <p>备注：此电子发票可作为报销凭证，与纸质发票具有同等法律效力。</p>\n              <div class=\"invoice-stamp\">\n                <span>智能齿科医院电子印章</span>\n              </div>\n              <div style=\"clear: both;\"></div>\n            </div>\n          </body>\n        </html>\n      `;\n      printWindow.document.write(html);\n      printWindow.document.close();\n      printWindow.onload = function () {\n        printWindow.print();\n        // printWindow.close()\n      };\n    },\n    // 刷新支付记录\n    refreshPayments() {\n      this.fetchAppointments();\n    },\n    // 格式化日期\n    formatDate(dateString) {\n      if (!dateString) return '-';\n      const date = new Date(dateString);\n      return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;\n    },\n    // 获取状态文本\n    getStatusText(status) {\n      switch (status) {\n        case 0:\n          return '待确认';\n        case 1:\n          return '已确认';\n        case 2:\n          return '已完成';\n        case 3:\n          return '已取消';\n        default:\n          return '未知状态';\n      }\n    },\n    // 获取状态类型（用于标签颜色）\n    getStatusType(status) {\n      switch (status) {\n        case 0:\n          return 'warning';\n        case 1:\n          return 'primary';\n        case 2:\n          return 'success';\n        case 3:\n          return 'danger';\n        default:\n          return 'info';\n      }\n    },\n    // 获取支付方式文本\n    getPaymentMethodText() {\n      switch (this.paymentMethod) {\n        case 'wechat':\n          return '微信';\n        case 'alipay':\n          return '支付宝';\n        case 'unionpay':\n          return '银联云闪付';\n        default:\n          return '';\n      }\n    }\n  }\n};","map":{"version":3,"names":["mapGetters","name","data","doctorList","unpaidAppointments","paidAppointments","paymentDialogVisible","invoiceDialogVisible","currentPayment","currentInvoice","paymentMethod","paymentLoading","treatmentFees","computed","mounted","fetchDoctors","fetchAppointments","methods","$http","get","then","response","code","catch","error","console","currentUser","id","appointments","filter","item","paymentStatus","status","map","doctorName","doctorId","paymentAmount","orderAmount","getFeeByTreatment","treatmentItem","$message","treatment","payNow","appointment","confirmPayment","amount","setTimeout","put","success","updatedAppointment","paymentTime","Date","index","findIndex","splice","unshift","message","finally","viewInvoice","printInvoice","printWindow","window","open","invoice","html","Math","floor","random","toString","padStart","realName","appointmentDate","appointmentTime","formatDate","document","write","close","onload","print","refreshPayments","dateString","date","getFullYear","getMonth","getDate","getHours","getMinutes","getStatusText","getStatusType","getPaymentMethodText"],"sources":["src/views/patient/Payment.vue"],"sourcesContent":["<template>\n  <div class=\"payment-container\">\n    <el-card class=\"payment-card\">\n      <div slot=\"header\">\n        <span>缴费管理</span>\n        <el-button style=\"float: right; padding: 3px 0\" type=\"text\" @click=\"refreshPayments\">\n          <i class=\"el-icon-refresh\"></i> 刷新\n        </el-button>\n      </div>\n      \n      <!-- 待支付项目 -->\n      <div class=\"payment-section\">\n        <h3>待支付项目</h3>\n        <div v-if=\"unpaidAppointments.length > 0\">\n          <el-table\n            :data=\"unpaidAppointments\"\n            style=\"width: 100%\"\n            border>\n            <el-table-column prop=\"id\" label=\"预约号\" width=\"80\"></el-table-column>\n            <el-table-column prop=\"treatmentItem\" label=\"就诊项目\" width=\"150\"></el-table-column>\n            <el-table-column prop=\"appointmentTime\" label=\"预约时间\" width=\"180\">\n              <template slot-scope=\"scope\">\n                {{ scope.row.appointmentDate }} {{ scope.row.appointmentTime }}\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"doctorName\" label=\"医生\" width=\"120\"></el-table-column>\n            <el-table-column prop=\"status\" label=\"预约状态\" width=\"100\">\n              <template slot-scope=\"scope\">\n                <el-tag :type=\"getStatusType(scope.row.status)\">\n                  {{ getStatusText(scope.row.status) }}\n                </el-tag>\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"paymentAmount\" label=\"应付金额\" width=\"120\">\n              <template slot-scope=\"scope\">\n                ¥{{ scope.row.paymentAmount || getFeeByTreatment(scope.row.treatmentItem) }}\n              </template>\n            </el-table-column>\n            <el-table-column label=\"操作\">\n              <template slot-scope=\"scope\">\n                <el-button \n                  type=\"primary\" \n                  size=\"mini\" \n                  @click=\"payNow(scope.row)\"\n                  :disabled=\"scope.row.status === 3\">\n                  立即支付\n                </el-button>\n              </template>\n            </el-table-column>\n          </el-table>\n        </div>\n        <div v-else class=\"empty-data\">\n          <i class=\"el-icon-wallet\"></i>\n          <p>暂无待缴费项目</p>\n        </div>\n      </div>\n      \n      <!-- 支付记录 -->\n      <div class=\"payment-section\">\n        <h3>支付记录</h3>\n        <div v-if=\"paidAppointments.length > 0\">\n          <el-table\n            :data=\"paidAppointments\"\n            style=\"width: 100%\"\n            border>\n            <el-table-column prop=\"id\" label=\"预约号\" width=\"80\"></el-table-column>\n            <el-table-column prop=\"treatmentItem\" label=\"就诊项目\" width=\"150\"></el-table-column>\n            <el-table-column prop=\"appointmentTime\" label=\"预约时间\" width=\"180\">\n              <template slot-scope=\"scope\">\n                {{ scope.row.appointmentDate }} {{ scope.row.appointmentTime }}\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"paymentTime\" label=\"支付时间\" width=\"180\">\n              <template slot-scope=\"scope\">\n                {{ formatDate(scope.row.paymentTime) }}\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"paymentAmount\" label=\"支付金额\" width=\"120\">\n              <template slot-scope=\"scope\">\n                ¥{{ scope.row.paymentAmount }}\n              </template>\n            </el-table-column>\n            <el-table-column label=\"操作\">\n              <template slot-scope=\"scope\">\n                <el-button type=\"info\" size=\"mini\" @click=\"viewInvoice(scope.row)\">查看发票</el-button>\n              </template>\n            </el-table-column>\n          </el-table>\n        </div>\n        <div v-else class=\"empty-data\">\n          <i class=\"el-icon-document\"></i>\n          <p>暂无支付记录</p>\n        </div>\n      </div>\n    </el-card>\n    \n    <!-- 支付对话框 -->\n    <el-dialog title=\"支付确认\" :visible.sync=\"paymentDialogVisible\" width=\"500px\">\n      <div v-if=\"currentPayment\" class=\"payment-dialog-content\">\n        <div class=\"payment-info\">\n          <div class=\"payment-item\">\n            <span class=\"label\">预约号：</span>\n            <span class=\"value\">{{ currentPayment.id }}</span>\n          </div>\n          <div class=\"payment-item\">\n            <span class=\"label\">就诊项目：</span>\n            <span class=\"value\">{{ currentPayment.treatmentItem }}</span>\n          </div>\n          <div class=\"payment-item\">\n            <span class=\"label\">预约时间：</span>\n            <span class=\"value\">{{ currentPayment.appointmentDate }} {{ currentPayment.appointmentTime }}</span>\n          </div>\n          <div class=\"payment-item payment-amount\">\n            <span class=\"label\">应付金额：</span>\n            <span class=\"value amount\">¥{{ currentPayment.paymentAmount || getFeeByTreatment(currentPayment.treatmentItem) }}</span>\n          </div>\n        </div>\n        \n        <div class=\"payment-method\">\n          <div class=\"label\">支付方式：</div>\n          <el-radio-group v-model=\"paymentMethod\">\n            <el-radio label=\"wechat\">微信支付</el-radio>\n            <el-radio label=\"alipay\">支付宝</el-radio>\n            <el-radio label=\"unionpay\">银联云闪付</el-radio>\n          </el-radio-group>\n        </div>\n        \n        <div class=\"payment-qrcode\">\n          <img src=\"https://via.placeholder.com/200x200.png?text=支付二维码\" alt=\"支付二维码\" />\n          <p class=\"text-center\">请使用{{ getPaymentMethodText() }}扫码支付</p>\n        </div>\n      </div>\n      \n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"paymentDialogVisible = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"confirmPayment\" :loading=\"paymentLoading\">确认已支付</el-button>\n      </span>\n    </el-dialog>\n    \n    <!-- 发票对话框 -->\n    <el-dialog title=\"电子发票\" :visible.sync=\"invoiceDialogVisible\" width=\"650px\">\n      <div v-if=\"currentInvoice\" class=\"invoice-content\">\n        <div class=\"invoice-header\">\n          <h2>电子发票</h2>\n          <p>发票编号：INV{{ currentInvoice.id }}{{ Math.floor(Math.random() * 10000).toString().padStart(4, '0') }}</p>\n        </div>\n        \n        <div class=\"invoice-info\">\n          <div class=\"invoice-row\">\n            <div class=\"invoice-label\">患者姓名：</div>\n            <div class=\"invoice-value\">{{ currentUser.realName }}</div>\n          </div>\n          <div class=\"invoice-row\">\n            <div class=\"invoice-label\">就诊项目：</div>\n            <div class=\"invoice-value\">{{ currentInvoice.treatmentItem }}</div>\n          </div>\n          <div class=\"invoice-row\">\n            <div class=\"invoice-label\">就诊医生：</div>\n            <div class=\"invoice-value\">{{ currentInvoice.doctorName }}</div>\n          </div>\n          <div class=\"invoice-row\">\n            <div class=\"invoice-label\">预约时间：</div>\n            <div class=\"invoice-value\">{{ currentInvoice.appointmentDate }} {{ currentInvoice.appointmentTime }}</div>\n          </div>\n          <div class=\"invoice-row\">\n            <div class=\"invoice-label\">开票日期：</div>\n            <div class=\"invoice-value\">{{ formatDate(currentInvoice.paymentTime) }}</div>\n          </div>\n        </div>\n        \n        <div class=\"invoice-table\">\n          <table>\n            <thead>\n              <tr>\n                <th>项目</th>\n                <th>数量</th>\n                <th>单价(元)</th>\n                <th>金额(元)</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr>\n                <td>{{ currentInvoice.treatmentItem }}</td>\n                <td>1</td>\n                <td>{{ currentInvoice.paymentAmount }}</td>\n                <td>{{ currentInvoice.paymentAmount }}</td>\n              </tr>\n            </tbody>\n            <tfoot>\n              <tr>\n                <td colspan=\"3\" class=\"text-right\">合计金额：</td>\n                <td>{{ currentInvoice.paymentAmount }}</td>\n              </tr>\n              <tr>\n                <td colspan=\"3\" class=\"text-right\">实收金额：</td>\n                <td>{{ currentInvoice.paymentAmount }}</td>\n              </tr>\n            </tfoot>\n          </table>\n        </div>\n        \n        <div class=\"invoice-footer\">\n          <p>备注：此电子发票可作为报销凭证，与纸质发票具有同等法律效力。</p>\n          <div class=\"invoice-stamp\">\n            <span>智能齿科医院电子印章</span>\n          </div>\n        </div>\n      </div>\n      \n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"invoiceDialogVisible = false\">关闭</el-button>\n        <el-button type=\"primary\" @click=\"printInvoice\">打印发票</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex'\n\nexport default {\n  name: 'PatientPayment',\n  data() {\n    return {\n      doctorList: [],\n      unpaidAppointments: [],\n      paidAppointments: [],\n      paymentDialogVisible: false,\n      invoiceDialogVisible: false,\n      currentPayment: null,\n      currentInvoice: null,\n      paymentMethod: 'wechat',\n      paymentLoading: false,\n      treatmentFees: {\n        '普通检查': 100,\n        '洗牙': 200,\n        '补牙': 500,\n        '拔牙': 300,\n        '正牙': 5000,\n        '种植牙': 8000\n      }\n    }\n  },\n  computed: {\n    ...mapGetters(['currentUser'])\n  },\n  mounted() {\n    this.fetchDoctors()\n    this.fetchAppointments()\n  },\n  methods: {\n    // 获取医生列表\n    fetchDoctors() {\n      this.$http.get('/user/doctors')\n        .then(response => {\n          if (response.data.code === 200) {\n            this.doctorList = response.data.data\n          }\n        })\n        .catch(error => {\n          console.error('获取医生列表错误:', error)\n        })\n    },\n    \n    // 获取预约列表\n    fetchAppointments() {\n      this.$http.get(`/appointment/patient/${this.currentUser.id}`)\n        .then(response => {\n          if (response.data.code === 200) {\n            const appointments = response.data.data || []\n            \n            // 分类预约：已支付和未支付\n            this.unpaidAppointments = appointments\n              .filter(item => item.paymentStatus === 0 && item.status !== 3)\n              .map(item => {\n                return {\n                  ...item,\n                  doctorName: item.doctorName || '医生' + item.doctorId, // 实际应该从后端获取医生名称\n                  paymentAmount: item.orderAmount || this.getFeeByTreatment(item.treatmentItem)\n                }\n              })\n            \n            this.paidAppointments = appointments\n              .filter(item => item.paymentStatus === 1)\n              .map(item => {\n                return {\n                  ...item,\n                  doctorName: item.doctorName || '医生' + item.doctorId,\n                  paymentAmount: item.orderAmount || this.getFeeByTreatment(item.treatmentItem)\n                }\n              })\n          }\n        })\n        .catch(error => {\n          console.error('获取预约记录失败:', error)\n          this.$message.error('获取预约记录失败，请稍后重试')\n        })\n    },\n    \n    // 根据治疗项目获取费用\n    getFeeByTreatment(treatment) {\n      return this.treatmentFees[treatment] || 300 // 默认300元\n    },\n    \n    // 立即支付\n    payNow(appointment) {\n      this.currentPayment = { ...appointment }\n      this.paymentMethod = 'wechat'\n      this.paymentDialogVisible = true\n    },\n    \n    // 确认支付\n    confirmPayment() {\n      if (!this.currentPayment) return\n      \n      this.paymentLoading = true\n      \n      // 计算支付金额\n      const amount = this.currentPayment.paymentAmount || this.getFeeByTreatment(this.currentPayment.treatmentItem)\n      \n      // 模拟支付请求\n      setTimeout(() => {\n        this.$http.put(`/appointment/${this.currentPayment.id}/pay?amount=${amount}`)\n          .then(response => {\n            if (response.data.code === 200) {\n              this.$message.success('支付成功')\n              this.paymentDialogVisible = false\n              \n              // 在前端更新当前支付对象的状态，避免刷新\n              const updatedAppointment = response.data.data || this.currentPayment\n              updatedAppointment.paymentStatus = 1\n              updatedAppointment.paymentTime = new Date()\n              \n              // 从未支付列表中移除\n              const index = this.unpaidAppointments.findIndex(item => item.id === this.currentPayment.id)\n              if (index !== -1) {\n                this.unpaidAppointments.splice(index, 1)\n              }\n              \n              // 添加到已支付列表\n              this.paidAppointments.unshift({\n                ...updatedAppointment,\n                doctorName: this.currentPayment.doctorName,\n                paymentAmount: amount\n              })\n              \n              // 刷新支付记录\n              this.fetchAppointments()\n            } else {\n              this.$message.error(response.data.message || '支付失败')\n            }\n          })\n          .catch(error => {\n            console.error('支付错误:', error)\n            this.$message.error('支付失败，请稍后重试')\n          })\n          .finally(() => {\n            this.paymentLoading = false\n          })\n      }, 1500) // 模拟网络延迟\n    },\n    \n    // 查看发票\n    viewInvoice(appointment) {\n      this.currentInvoice = { ...appointment }\n      this.invoiceDialogVisible = true\n    },\n    \n    // 打印发票\n    printInvoice() {\n      this.$message.success('打印功能已触发，请检查打印机状态')\n      \n      // 这里可以实现实际的打印功能，例如使用window.print()或生成PDF\n      const printWindow = window.open('', '_blank')\n      const invoice = this.currentInvoice\n      \n      const html = `\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <title>电子发票</title>\n            <style>\n              body { font-family: Arial, sans-serif; margin: 20px; }\n              .invoice-header { text-align: center; margin-bottom: 30px; }\n              .invoice-header h2 { margin-bottom: 5px; }\n              .invoice-info { margin-bottom: 30px; }\n              .invoice-row { display: flex; margin-bottom: 10px; }\n              .invoice-label { width: 150px; font-weight: bold; }\n              .invoice-value { flex: 1; }\n              .invoice-table { margin-bottom: 30px; }\n              .invoice-table table { width: 100%; border-collapse: collapse; }\n              .invoice-table th, .invoice-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n              .invoice-table th { background-color: #f2f2f2; }\n              .invoice-table tfoot td { font-weight: bold; }\n              .text-right { text-align: right; }\n              .invoice-footer { margin-top: 50px; }\n              .invoice-stamp { margin-top: 30px; text-align: right; border: 2px dashed #f00; display: inline-block; padding: 10px 20px; color: #f00; font-weight: bold; float: right; }\n            </style>\n          </head>\n          <body>\n            <div class=\"invoice-header\">\n              <h2>电子发票</h2>\n              <p>发票编号：INV${invoice.id}${Math.floor(Math.random() * 10000).toString().padStart(4, '0')}</p>\n            </div>\n            \n            <div class=\"invoice-info\">\n              <div class=\"invoice-row\">\n                <div class=\"invoice-label\">患者姓名：</div>\n                <div class=\"invoice-value\">${this.currentUser.realName}</div>\n              </div>\n              <div class=\"invoice-row\">\n                <div class=\"invoice-label\">就诊项目：</div>\n                <div class=\"invoice-value\">${invoice.treatmentItem}</div>\n              </div>\n              <div class=\"invoice-row\">\n                <div class=\"invoice-label\">就诊医生：</div>\n                <div class=\"invoice-value\">${invoice.doctorName}</div>\n              </div>\n              <div class=\"invoice-row\">\n                <div class=\"invoice-label\">预约时间：</div>\n                <div class=\"invoice-value\">${invoice.appointmentDate} ${invoice.appointmentTime}</div>\n              </div>\n              <div class=\"invoice-row\">\n                <div class=\"invoice-label\">开票日期：</div>\n                <div class=\"invoice-value\">${this.formatDate(invoice.paymentTime)}</div>\n              </div>\n            </div>\n            \n            <div class=\"invoice-table\">\n              <table>\n                <thead>\n                  <tr>\n                    <th>项目</th>\n                    <th>数量</th>\n                    <th>单价(元)</th>\n                    <th>金额(元)</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr>\n                    <td>${invoice.treatmentItem}</td>\n                    <td>1</td>\n                    <td>${invoice.paymentAmount}</td>\n                    <td>${invoice.paymentAmount}</td>\n                  </tr>\n                </tbody>\n                <tfoot>\n                  <tr>\n                    <td colspan=\"3\" class=\"text-right\">合计金额：</td>\n                    <td>${invoice.paymentAmount}</td>\n                  </tr>\n                  <tr>\n                    <td colspan=\"3\" class=\"text-right\">实收金额：</td>\n                    <td>${invoice.paymentAmount}</td>\n                  </tr>\n                </tfoot>\n              </table>\n            </div>\n            \n            <div class=\"invoice-footer\">\n              <p>备注：此电子发票可作为报销凭证，与纸质发票具有同等法律效力。</p>\n              <div class=\"invoice-stamp\">\n                <span>智能齿科医院电子印章</span>\n              </div>\n              <div style=\"clear: both;\"></div>\n            </div>\n          </body>\n        </html>\n      `\n      printWindow.document.write(html)\n      printWindow.document.close()\n      printWindow.onload = function() {\n        printWindow.print()\n        // printWindow.close()\n      }\n    },\n    \n    // 刷新支付记录\n    refreshPayments() {\n      this.fetchAppointments()\n    },\n    \n    // 格式化日期\n    formatDate(dateString) {\n      if (!dateString) return '-'\n      const date = new Date(dateString)\n      return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`\n    },\n    \n    // 获取状态文本\n    getStatusText(status) {\n      switch (status) {\n        case 0: return '待确认'\n        case 1: return '已确认'\n        case 2: return '已完成'\n        case 3: return '已取消'\n        default: return '未知状态'\n      }\n    },\n    \n    // 获取状态类型（用于标签颜色）\n    getStatusType(status) {\n      switch (status) {\n        case 0: return 'warning'\n        case 1: return 'primary'\n        case 2: return 'success'\n        case 3: return 'danger'\n        default: return 'info'\n      }\n    },\n    \n    // 获取支付方式文本\n    getPaymentMethodText() {\n      switch (this.paymentMethod) {\n        case 'wechat': return '微信'\n        case 'alipay': return '支付宝'\n        case 'unionpay': return '银联云闪付'\n        default: return ''\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.payment-container {\n  height: 100%;\n}\n\n.payment-card {\n  margin-bottom: 20px;\n}\n\n.payment-section {\n  margin-bottom: 30px;\n}\n\n.payment-section h3 {\n  margin-top: 0;\n  padding-bottom: 10px;\n  border-bottom: 1px solid #ebeef5;\n}\n\n.empty-data {\n  text-align: center;\n  padding: 30px 0;\n  color: #909399;\n}\n\n.empty-data i {\n  font-size: 40px;\n  margin-bottom: 10px;\n}\n\n.payment-dialog-content {\n  padding: 0 20px;\n}\n\n.payment-info {\n  margin-bottom: 20px;\n}\n\n.payment-item {\n  margin-bottom: 10px;\n  display: flex;\n}\n\n.payment-item .label {\n  width: 100px;\n  color: #606266;\n}\n\n.payment-item .value {\n  flex: 1;\n}\n\n.payment-amount {\n  font-size: 18px;\n}\n\n.payment-amount .amount {\n  color: #f56c6c;\n  font-weight: bold;\n}\n\n.payment-method {\n  margin-bottom: 20px;\n}\n\n.payment-method .label {\n  margin-bottom: 10px;\n  color: #606266;\n}\n\n.payment-qrcode {\n  text-align: center;\n  margin: 20px 0;\n}\n\n.payment-qrcode img {\n  width: 200px;\n  height: 200px;\n  border: 1px solid #dcdfe6;\n}\n\n.text-center {\n  text-align: center;\n}\n\n/* 发票样式 */\n.invoice-content {\n  padding: 20px;\n}\n\n.invoice-header {\n  text-align: center;\n  margin-bottom: 30px;\n}\n\n.invoice-header h2 {\n  margin-bottom: 5px;\n}\n\n.invoice-info {\n  margin-bottom: 30px;\n}\n\n.invoice-row {\n  display: flex;\n  margin-bottom: 10px;\n}\n\n.invoice-label {\n  width: 150px;\n  font-weight: bold;\n}\n\n.invoice-value {\n  flex: 1;\n}\n\n.invoice-table {\n  margin-bottom: 30px;\n}\n\n.invoice-table table {\n  width: 100%;\n  border-collapse: collapse;\n}\n\n.invoice-table th,\n.invoice-table td {\n  border: 1px solid #ddd;\n  padding: 8px;\n  text-align: left;\n}\n\n.invoice-table th {\n  background-color: #f2f2f2;\n}\n\n.invoice-table tfoot td {\n  font-weight: bold;\n}\n\n.text-right {\n  text-align: right;\n}\n\n.invoice-footer {\n  margin-top: 50px;\n}\n\n.invoice-stamp {\n  margin-top: 30px;\n  text-align: right;\n  border: 2px dashed #f00;\n  padding: 10px 20px;\n  color: #f00;\n  font-weight: bold;\n  float: right;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}