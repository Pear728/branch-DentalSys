{"ast":null,"code":"import { mapGetters } from 'vuex';\nexport default {\n  name: 'PatientPayment',\n  data() {\n    return {\n      allAppointments: [],\n      doctorList: [],\n      paymentDialogVisible: false,\n      invoiceDialogVisible: false,\n      currentPayment: null,\n      currentInvoice: null,\n      paymentMethod: 'wechat',\n      paymentLoading: false,\n      appointmentId: null,\n      // 用于直接支付特定预约\n      // 治疗项目费用表\n      treatmentFees: {\n        '普通检查': 50,\n        '口腔洁牙': 200,\n        '牙齿修复': 500,\n        '牙齿矫正': 2000,\n        '智齿拔除': 800,\n        '儿童口腔': 100,\n        '其他': 300\n      }\n    };\n  },\n  computed: {\n    ...mapGetters(['currentUser']),\n    // 待支付项目\n    unpaidAppointments() {\n      return this.allAppointments.filter(item => item.isPaid === 0 && item.status !== 3);\n    },\n    // 已支付记录\n    paidAppointments() {\n      return this.allAppointments.filter(item => item.isPaid === 1);\n    }\n  },\n  created() {\n    // 检查URL参数是否有appointmentId\n    if (this.$route.query.appointmentId) {\n      this.appointmentId = this.$route.query.appointmentId;\n    }\n  },\n  mounted() {\n    this.fetchDoctors();\n    this.fetchAppointments();\n\n    // 如果有特定预约ID，直接支付该预约\n    if (this.appointmentId) {\n      this.$nextTick(() => {\n        const appointment = this.allAppointments.find(a => a.id == this.appointmentId);\n        if (appointment && appointment.isPaid === 0) {\n          this.payNow(appointment);\n        }\n      });\n    }\n  },\n  methods: {\n    // 获取医生列表\n    fetchDoctors() {\n      this.$http.get('/user/doctors').then(response => {\n        if (response.data.code === 200) {\n          this.doctorList = response.data.data;\n        }\n      }).catch(error => {\n        console.error('获取医生列表错误:', error);\n      });\n    },\n    // 获取预约列表\n    fetchAppointments() {\n      this.$http.get(`/appointment/patient/${this.currentUser.id}`).then(response => {\n        if (response.data.code === 200) {\n          // 处理预约数据，添加医生姓名\n          this.allAppointments = response.data.data.map(item => {\n            const doctor = this.doctorList.find(doc => doc.id === item.doctorId);\n\n            // 如果没有设置支付金额，根据治疗项目设置默认金额\n            if (!item.paymentAmount && item.isPaid === 0) {\n              item.paymentAmount = this.getFeeByTreatment(item.treatmentItem);\n            }\n            return {\n              ...item,\n              doctorName: doctor ? doctor.realName : `医生(ID:${item.doctorId})`\n            };\n          });\n        } else {\n          this.$message.error(response.data.message || '获取预约记录失败');\n        }\n      }).catch(error => {\n        console.error('获取预约记录错误:', error);\n        this.$message.error('获取预约记录失败，请稍后重试');\n      });\n    },\n    // 根据治疗项目获取费用\n    getFeeByTreatment(treatment) {\n      return this.treatmentFees[treatment] || 300; // 默认300元\n    },\n    // 立即支付\n    payNow(appointment) {\n      this.currentPayment = {\n        ...appointment\n      };\n      this.paymentMethod = 'wechat';\n      this.paymentDialogVisible = true;\n    },\n    // 确认支付\n    confirmPayment() {\n      this.paymentLoading = true;\n\n      // 获取支付金额\n      const amount = this.currentPayment.paymentAmount || this.getFeeByTreatment(this.currentPayment.treatmentItem);\n\n      // 发送支付请求\n      this.$http.put(`/appointment/${this.currentPayment.id}/pay?amount=${amount}`).then(response => {\n        if (response.data.code === 200) {\n          this.$message.success('支付成功');\n          this.paymentDialogVisible = false;\n          this.fetchAppointments(); // 刷新列表\n        } else {\n          this.$message.error(response.data.message || '支付失败');\n        }\n      }).catch(error => {\n        console.error('支付错误:', error);\n        this.$message.error('支付失败，请稍后重试');\n      }).finally(() => {\n        this.paymentLoading = false;\n      });\n    },\n    // 查看发票\n    viewInvoice(appointment) {\n      this.currentInvoice = {\n        ...appointment\n      };\n      this.invoiceDialogVisible = true;\n    },\n    // 打印发票\n    printInvoice() {\n      this.$message.success('打印功能已触发，请检查打印机状态');\n\n      // 这里可以实现实际的打印功能，例如使用window.print()或生成PDF\n      const printWindow = window.open('', '_blank');\n      if (printWindow) {\n        const invoice = this.currentInvoice;\n        const html = `\n          <html>\n            <head>\n              <title>电子发票 - INV${invoice.id}${Math.floor(Math.random() * 10000).toString().padStart(4, '0')}</title>\n              <style>\n                body { font-family: Arial, sans-serif; padding: 20px; }\n                .invoice-header { text-align: center; margin-bottom: 30px; }\n                .invoice-header h2 { margin-bottom: 5px; }\n                .invoice-info { margin-bottom: 30px; }\n                .invoice-row { display: flex; margin-bottom: 10px; }\n                .invoice-label { width: 150px; font-weight: bold; }\n                .invoice-value { flex: 1; }\n                .invoice-table { margin-bottom: 30px; }\n                table { width: 100%; border-collapse: collapse; }\n                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n                th { background-color: #f2f2f2; }\n                tfoot td { font-weight: bold; }\n                .text-right { text-align: right; }\n                .invoice-footer { margin-top: 50px; }\n                .invoice-stamp { \n                  margin-top: 30px;\n                  text-align: right;\n                  border: 2px dashed #f00;\n                  display: inline-block;\n                  padding: 10px 20px;\n                  color: #f00;\n                  font-weight: bold;\n                  float: right;\n                }\n              </style>\n            </head>\n            <body>\n              <div class=\"invoice-header\">\n                <h2>电子发票</h2>\n                <p>发票编号：INV${invoice.id}${Math.floor(Math.random() * 10000).toString().padStart(4, '0')}</p>\n              </div>\n              \n              <div class=\"invoice-info\">\n                <div class=\"invoice-row\">\n                  <div class=\"invoice-label\">收款方：</div>\n                  <div class=\"invoice-value\">智能齿科医院</div>\n                </div>\n                <div class=\"invoice-row\">\n                  <div class=\"invoice-label\">纳税人识别号：</div>\n                  <div class=\"invoice-value\">91440300XXXXXXXXXX</div>\n                </div>\n                <div class=\"invoice-row\">\n                  <div class=\"invoice-label\">患者姓名：</div>\n                  <div class=\"invoice-value\">${this.currentUser.realName}</div>\n                </div>\n                <div class=\"invoice-row\">\n                  <div class=\"invoice-label\">就诊项目：</div>\n                  <div class=\"invoice-value\">${invoice.treatmentItem}</div>\n                </div>\n                <div class=\"invoice-row\">\n                  <div class=\"invoice-label\">开票日期：</div>\n                  <div class=\"invoice-value\">${this.formatDate(invoice.paymentTime)}</div>\n                </div>\n              </div>\n              \n              <div class=\"invoice-table\">\n                <table>\n                  <thead>\n                    <tr>\n                      <th>项目</th>\n                      <th>数量</th>\n                      <th>单价(元)</th>\n                      <th>金额(元)</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    <tr>\n                      <td>${invoice.treatmentItem}</td>\n                      <td>1</td>\n                      <td>${invoice.paymentAmount}</td>\n                      <td>${invoice.paymentAmount}</td>\n                    </tr>\n                  </tbody>\n                  <tfoot>\n                    <tr>\n                      <td colspan=\"3\" class=\"text-right\">合计金额：</td>\n                      <td>${invoice.paymentAmount}</td>\n                    </tr>\n                    <tr>\n                      <td colspan=\"3\" class=\"text-right\">实收金额：</td>\n                      <td>${invoice.paymentAmount}</td>\n                    </tr>\n                  </tfoot>\n                </table>\n              </div>\n              \n              <div class=\"invoice-footer\">\n                <p>备注：此电子发票可作为报销凭证，与纸质发票具有同等法律效力。</p>\n                <div class=\"invoice-stamp\">\n                  <span>智能齿科医院电子印章</span>\n                </div>\n                <div style=\"clear: both;\"></div>\n              </div>\n            </body>\n          </html>\n        `;\n        printWindow.document.write(html);\n        printWindow.document.close();\n        printWindow.onload = function () {\n          printWindow.print();\n          // printWindow.close()\n        };\n      }\n    },\n    // 刷新支付记录\n    refreshPayments() {\n      this.fetchAppointments();\n    },\n    // 格式化日期\n    formatDate(dateString) {\n      if (!dateString) return '-';\n      const date = new Date(dateString);\n      return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;\n    },\n    // 获取状态文本\n    getStatusText(status) {\n      switch (status) {\n        case 0:\n          return '待确认';\n        case 1:\n          return '已确认';\n        case 2:\n          return '已完成';\n        case 3:\n          return '已取消';\n        default:\n          return '未知状态';\n      }\n    },\n    // 获取状态类型（用于标签颜色）\n    getStatusType(status) {\n      switch (status) {\n        case 0:\n          return 'warning';\n        case 1:\n          return 'primary';\n        case 2:\n          return 'success';\n        case 3:\n          return 'danger';\n        default:\n          return 'info';\n      }\n    },\n    // 获取支付方式文本\n    getPaymentMethodText() {\n      switch (this.paymentMethod) {\n        case 'wechat':\n          return '微信';\n        case 'alipay':\n          return '支付宝';\n        case 'unionpay':\n          return '银联云闪付';\n        default:\n          return '';\n      }\n    }\n  }\n};","map":{"version":3,"names":["mapGetters","name","data","allAppointments","doctorList","paymentDialogVisible","invoiceDialogVisible","currentPayment","currentInvoice","paymentMethod","paymentLoading","appointmentId","treatmentFees","computed","unpaidAppointments","filter","item","isPaid","status","paidAppointments","created","$route","query","mounted","fetchDoctors","fetchAppointments","$nextTick","appointment","find","a","id","payNow","methods","$http","get","then","response","code","catch","error","console","currentUser","map","doctor","doc","doctorId","paymentAmount","getFeeByTreatment","treatmentItem","doctorName","realName","$message","message","treatment","confirmPayment","amount","put","success","finally","viewInvoice","printInvoice","printWindow","window","open","invoice","html","Math","floor","random","toString","padStart","formatDate","paymentTime","document","write","close","onload","print","refreshPayments","dateString","date","Date","getFullYear","getMonth","getDate","getHours","getMinutes","getStatusText","getStatusType","getPaymentMethodText"],"sources":["src/views/patient/Payment.vue"],"sourcesContent":["<template>\n  <div class=\"payment-container\">\n    <el-card class=\"payment-card\">\n      <div slot=\"header\">\n        <span>缴费管理</span>\n        <el-button style=\"float: right; padding: 3px 0\" type=\"text\" @click=\"refreshPayments\">\n          <i class=\"el-icon-refresh\"></i> 刷新\n        </el-button>\n      </div>\n      \n      <!-- 待支付项目 -->\n      <div class=\"payment-section\">\n        <h3>待支付项目</h3>\n        <div v-if=\"unpaidAppointments.length > 0\">\n          <el-table\n            :data=\"unpaidAppointments\"\n            style=\"width: 100%\"\n            border>\n            <el-table-column prop=\"id\" label=\"预约号\" width=\"80\"></el-table-column>\n            <el-table-column prop=\"treatmentItem\" label=\"就诊项目\" width=\"150\"></el-table-column>\n            <el-table-column prop=\"appointmentTime\" label=\"预约时间\" width=\"180\">\n              <template slot-scope=\"scope\">\n                {{ formatDate(scope.row.appointmentTime) }}\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"doctorName\" label=\"医生\" width=\"120\"></el-table-column>\n            <el-table-column prop=\"status\" label=\"预约状态\" width=\"100\">\n              <template slot-scope=\"scope\">\n                <el-tag :type=\"getStatusType(scope.row.status)\">\n                  {{ getStatusText(scope.row.status) }}\n                </el-tag>\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"paymentAmount\" label=\"应付金额\" width=\"120\">\n              <template slot-scope=\"scope\">\n                ¥{{ scope.row.paymentAmount || getFeeByTreatment(scope.row.treatmentItem) }}\n              </template>\n            </el-table-column>\n            <el-table-column label=\"操作\">\n              <template slot-scope=\"scope\">\n                <el-button \n                  type=\"primary\" \n                  size=\"mini\" \n                  @click=\"payNow(scope.row)\"\n                  :disabled=\"scope.row.status === 3\">\n                  立即支付\n                </el-button>\n              </template>\n            </el-table-column>\n          </el-table>\n        </div>\n        <div v-else class=\"empty-data\">\n          <i class=\"el-icon-wallet\"></i>\n          <p>暂无待缴费项目</p>\n        </div>\n      </div>\n      \n      <!-- 支付记录 -->\n      <div class=\"payment-section\">\n        <h3>支付记录</h3>\n        <div v-if=\"paidAppointments.length > 0\">\n          <el-table\n            :data=\"paidAppointments\"\n            style=\"width: 100%\"\n            border>\n            <el-table-column prop=\"id\" label=\"预约号\" width=\"80\"></el-table-column>\n            <el-table-column prop=\"treatmentItem\" label=\"就诊项目\" width=\"150\"></el-table-column>\n            <el-table-column prop=\"appointmentTime\" label=\"预约时间\" width=\"180\">\n              <template slot-scope=\"scope\">\n                {{ formatDate(scope.row.appointmentTime) }}\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"paymentTime\" label=\"支付时间\" width=\"180\">\n              <template slot-scope=\"scope\">\n                {{ formatDate(scope.row.paymentTime) }}\n              </template>\n            </el-table-column>\n            <el-table-column prop=\"paymentAmount\" label=\"支付金额\" width=\"120\">\n              <template slot-scope=\"scope\">\n                ¥{{ scope.row.paymentAmount }}\n              </template>\n            </el-table-column>\n            <el-table-column label=\"操作\">\n              <template slot-scope=\"scope\">\n                <el-button type=\"info\" size=\"mini\" @click=\"viewInvoice(scope.row)\">查看发票</el-button>\n              </template>\n            </el-table-column>\n          </el-table>\n        </div>\n        <div v-else class=\"empty-data\">\n          <i class=\"el-icon-document\"></i>\n          <p>暂无支付记录</p>\n        </div>\n      </div>\n    </el-card>\n    \n    <!-- 支付对话框 -->\n    <el-dialog title=\"支付确认\" :visible.sync=\"paymentDialogVisible\" width=\"500px\">\n      <div v-if=\"currentPayment\" class=\"payment-dialog-content\">\n        <div class=\"payment-info\">\n          <p><strong>预约号：</strong>{{ currentPayment.id }}</p>\n          <p><strong>就诊项目：</strong>{{ currentPayment.treatmentItem }}</p>\n          <p><strong>预约时间：</strong>{{ formatDate(currentPayment.appointmentTime) }}</p>\n          <p><strong>医生：</strong>{{ currentPayment.doctorName }}</p>\n          <p class=\"payment-amount\">\n            <strong>应付金额：</strong>\n            <span class=\"amount\">¥{{ currentPayment.paymentAmount || getFeeByTreatment(currentPayment.treatmentItem) }}</span>\n          </p>\n        </div>\n        \n        <div class=\"payment-method\">\n          <p><strong>支付方式：</strong></p>\n          <el-radio-group v-model=\"paymentMethod\">\n            <el-radio label=\"wechat\">微信支付</el-radio>\n            <el-radio label=\"alipay\">支付宝</el-radio>\n            <el-radio label=\"unionpay\">银联</el-radio>\n          </el-radio-group>\n        </div>\n        \n        <div class=\"payment-qrcode\" v-if=\"paymentMethod\">\n          <img src=\"https://via.placeholder.com/200x200.png?text=支付二维码\" alt=\"支付二维码\" />\n          <p class=\"text-center\">请使用{{ getPaymentMethodText() }}扫码支付</p>\n        </div>\n      </div>\n      \n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"paymentDialogVisible = false\">取消</el-button>\n        <el-button type=\"primary\" @click=\"confirmPayment\" :loading=\"paymentLoading\">确认已支付</el-button>\n      </span>\n    </el-dialog>\n    \n    <!-- 发票对话框 -->\n    <el-dialog title=\"电子发票\" :visible.sync=\"invoiceDialogVisible\" width=\"650px\">\n      <div v-if=\"currentInvoice\" class=\"invoice-content\">\n        <div class=\"invoice-header\">\n          <h2>电子发票</h2>\n          <p>发票编号：INV{{ currentInvoice.id }}{{ Math.floor(Math.random() * 10000).toString().padStart(4, '0') }}</p>\n        </div>\n        \n        <div class=\"invoice-info\">\n          <div class=\"invoice-row\">\n            <div class=\"invoice-label\">收款方：</div>\n            <div class=\"invoice-value\">智能齿科医院</div>\n          </div>\n          <div class=\"invoice-row\">\n            <div class=\"invoice-label\">纳税人识别号：</div>\n            <div class=\"invoice-value\">91440300XXXXXXXXXX</div>\n          </div>\n          <div class=\"invoice-row\">\n            <div class=\"invoice-label\">患者姓名：</div>\n            <div class=\"invoice-value\">{{ currentUser.realName }}</div>\n          </div>\n          <div class=\"invoice-row\">\n            <div class=\"invoice-label\">就诊项目：</div>\n            <div class=\"invoice-value\">{{ currentInvoice.treatmentItem }}</div>\n          </div>\n          <div class=\"invoice-row\">\n            <div class=\"invoice-label\">开票日期：</div>\n            <div class=\"invoice-value\">{{ formatDate(currentInvoice.paymentTime) }}</div>\n          </div>\n        </div>\n        \n        <div class=\"invoice-table\">\n          <table>\n            <thead>\n              <tr>\n                <th>项目</th>\n                <th>数量</th>\n                <th>单价(元)</th>\n                <th>金额(元)</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr>\n                <td>{{ currentInvoice.treatmentItem }}</td>\n                <td>1</td>\n                <td>{{ currentInvoice.paymentAmount }}</td>\n                <td>{{ currentInvoice.paymentAmount }}</td>\n              </tr>\n            </tbody>\n            <tfoot>\n              <tr>\n                <td colspan=\"3\" class=\"text-right\">合计金额：</td>\n                <td>{{ currentInvoice.paymentAmount }}</td>\n              </tr>\n              <tr>\n                <td colspan=\"3\" class=\"text-right\">实收金额：</td>\n                <td>{{ currentInvoice.paymentAmount }}</td>\n              </tr>\n            </tfoot>\n          </table>\n        </div>\n        \n        <div class=\"invoice-footer\">\n          <p>备注：此电子发票可作为报销凭证，与纸质发票具有同等法律效力。</p>\n          <div class=\"invoice-stamp\">\n            <span>智能齿科医院电子印章</span>\n          </div>\n        </div>\n      </div>\n      \n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button type=\"primary\" @click=\"printInvoice\">打印发票</el-button>\n        <el-button @click=\"invoiceDialogVisible = false\">关闭</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from 'vuex'\n\nexport default {\n  name: 'PatientPayment',\n  data() {\n    return {\n      allAppointments: [],\n      doctorList: [],\n      paymentDialogVisible: false,\n      invoiceDialogVisible: false,\n      currentPayment: null,\n      currentInvoice: null,\n      paymentMethod: 'wechat',\n      paymentLoading: false,\n      appointmentId: null, // 用于直接支付特定预约\n      // 治疗项目费用表\n      treatmentFees: {\n        '普通检查': 50,\n        '口腔洁牙': 200,\n        '牙齿修复': 500,\n        '牙齿矫正': 2000,\n        '智齿拔除': 800,\n        '儿童口腔': 100,\n        '其他': 300\n      }\n    }\n  },\n  computed: {\n    ...mapGetters(['currentUser']),\n    \n    // 待支付项目\n    unpaidAppointments() {\n      return this.allAppointments.filter(item => item.isPaid === 0 && item.status !== 3)\n    },\n    \n    // 已支付记录\n    paidAppointments() {\n      return this.allAppointments.filter(item => item.isPaid === 1)\n    }\n  },\n  created() {\n    // 检查URL参数是否有appointmentId\n    if (this.$route.query.appointmentId) {\n      this.appointmentId = this.$route.query.appointmentId\n    }\n  },\n  mounted() {\n    this.fetchDoctors()\n    this.fetchAppointments()\n    \n    // 如果有特定预约ID，直接支付该预约\n    if (this.appointmentId) {\n      this.$nextTick(() => {\n        const appointment = this.allAppointments.find(a => a.id == this.appointmentId)\n        if (appointment && appointment.isPaid === 0) {\n          this.payNow(appointment)\n        }\n      })\n    }\n  },\n  methods: {\n    // 获取医生列表\n    fetchDoctors() {\n      this.$http.get('/user/doctors')\n        .then(response => {\n          if (response.data.code === 200) {\n            this.doctorList = response.data.data\n          }\n        })\n        .catch(error => {\n          console.error('获取医生列表错误:', error)\n        })\n    },\n    \n    // 获取预约列表\n    fetchAppointments() {\n      this.$http.get(`/appointment/patient/${this.currentUser.id}`)\n        .then(response => {\n          if (response.data.code === 200) {\n            // 处理预约数据，添加医生姓名\n            this.allAppointments = response.data.data.map(item => {\n              const doctor = this.doctorList.find(doc => doc.id === item.doctorId)\n              \n              // 如果没有设置支付金额，根据治疗项目设置默认金额\n              if (!item.paymentAmount && item.isPaid === 0) {\n                item.paymentAmount = this.getFeeByTreatment(item.treatmentItem)\n              }\n              \n              return {\n                ...item,\n                doctorName: doctor ? doctor.realName : `医生(ID:${item.doctorId})`\n              }\n            })\n          } else {\n            this.$message.error(response.data.message || '获取预约记录失败')\n          }\n        })\n        .catch(error => {\n          console.error('获取预约记录错误:', error)\n          this.$message.error('获取预约记录失败，请稍后重试')\n        })\n    },\n    \n    // 根据治疗项目获取费用\n    getFeeByTreatment(treatment) {\n      return this.treatmentFees[treatment] || 300 // 默认300元\n    },\n    \n    // 立即支付\n    payNow(appointment) {\n      this.currentPayment = { ...appointment }\n      this.paymentMethod = 'wechat'\n      this.paymentDialogVisible = true\n    },\n    \n    // 确认支付\n    confirmPayment() {\n      this.paymentLoading = true\n      \n      // 获取支付金额\n      const amount = this.currentPayment.paymentAmount || \n                    this.getFeeByTreatment(this.currentPayment.treatmentItem)\n      \n      // 发送支付请求\n      this.$http.put(`/appointment/${this.currentPayment.id}/pay?amount=${amount}`)\n        .then(response => {\n          if (response.data.code === 200) {\n            this.$message.success('支付成功')\n            this.paymentDialogVisible = false\n            this.fetchAppointments() // 刷新列表\n          } else {\n            this.$message.error(response.data.message || '支付失败')\n          }\n        })\n        .catch(error => {\n          console.error('支付错误:', error)\n          this.$message.error('支付失败，请稍后重试')\n        })\n        .finally(() => {\n          this.paymentLoading = false\n        })\n    },\n    \n    // 查看发票\n    viewInvoice(appointment) {\n      this.currentInvoice = { ...appointment }\n      this.invoiceDialogVisible = true\n    },\n    \n    // 打印发票\n    printInvoice() {\n      this.$message.success('打印功能已触发，请检查打印机状态')\n      \n      // 这里可以实现实际的打印功能，例如使用window.print()或生成PDF\n      const printWindow = window.open('', '_blank')\n      if (printWindow) {\n        const invoice = this.currentInvoice\n        const html = `\n          <html>\n            <head>\n              <title>电子发票 - INV${invoice.id}${Math.floor(Math.random() * 10000).toString().padStart(4, '0')}</title>\n              <style>\n                body { font-family: Arial, sans-serif; padding: 20px; }\n                .invoice-header { text-align: center; margin-bottom: 30px; }\n                .invoice-header h2 { margin-bottom: 5px; }\n                .invoice-info { margin-bottom: 30px; }\n                .invoice-row { display: flex; margin-bottom: 10px; }\n                .invoice-label { width: 150px; font-weight: bold; }\n                .invoice-value { flex: 1; }\n                .invoice-table { margin-bottom: 30px; }\n                table { width: 100%; border-collapse: collapse; }\n                th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }\n                th { background-color: #f2f2f2; }\n                tfoot td { font-weight: bold; }\n                .text-right { text-align: right; }\n                .invoice-footer { margin-top: 50px; }\n                .invoice-stamp { \n                  margin-top: 30px;\n                  text-align: right;\n                  border: 2px dashed #f00;\n                  display: inline-block;\n                  padding: 10px 20px;\n                  color: #f00;\n                  font-weight: bold;\n                  float: right;\n                }\n              </style>\n            </head>\n            <body>\n              <div class=\"invoice-header\">\n                <h2>电子发票</h2>\n                <p>发票编号：INV${invoice.id}${Math.floor(Math.random() * 10000).toString().padStart(4, '0')}</p>\n              </div>\n              \n              <div class=\"invoice-info\">\n                <div class=\"invoice-row\">\n                  <div class=\"invoice-label\">收款方：</div>\n                  <div class=\"invoice-value\">智能齿科医院</div>\n                </div>\n                <div class=\"invoice-row\">\n                  <div class=\"invoice-label\">纳税人识别号：</div>\n                  <div class=\"invoice-value\">91440300XXXXXXXXXX</div>\n                </div>\n                <div class=\"invoice-row\">\n                  <div class=\"invoice-label\">患者姓名：</div>\n                  <div class=\"invoice-value\">${this.currentUser.realName}</div>\n                </div>\n                <div class=\"invoice-row\">\n                  <div class=\"invoice-label\">就诊项目：</div>\n                  <div class=\"invoice-value\">${invoice.treatmentItem}</div>\n                </div>\n                <div class=\"invoice-row\">\n                  <div class=\"invoice-label\">开票日期：</div>\n                  <div class=\"invoice-value\">${this.formatDate(invoice.paymentTime)}</div>\n                </div>\n              </div>\n              \n              <div class=\"invoice-table\">\n                <table>\n                  <thead>\n                    <tr>\n                      <th>项目</th>\n                      <th>数量</th>\n                      <th>单价(元)</th>\n                      <th>金额(元)</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    <tr>\n                      <td>${invoice.treatmentItem}</td>\n                      <td>1</td>\n                      <td>${invoice.paymentAmount}</td>\n                      <td>${invoice.paymentAmount}</td>\n                    </tr>\n                  </tbody>\n                  <tfoot>\n                    <tr>\n                      <td colspan=\"3\" class=\"text-right\">合计金额：</td>\n                      <td>${invoice.paymentAmount}</td>\n                    </tr>\n                    <tr>\n                      <td colspan=\"3\" class=\"text-right\">实收金额：</td>\n                      <td>${invoice.paymentAmount}</td>\n                    </tr>\n                  </tfoot>\n                </table>\n              </div>\n              \n              <div class=\"invoice-footer\">\n                <p>备注：此电子发票可作为报销凭证，与纸质发票具有同等法律效力。</p>\n                <div class=\"invoice-stamp\">\n                  <span>智能齿科医院电子印章</span>\n                </div>\n                <div style=\"clear: both;\"></div>\n              </div>\n            </body>\n          </html>\n        `\n        printWindow.document.write(html)\n        printWindow.document.close()\n        printWindow.onload = function() {\n          printWindow.print()\n          // printWindow.close()\n        }\n      }\n    },\n    \n    // 刷新支付记录\n    refreshPayments() {\n      this.fetchAppointments()\n    },\n    \n    // 格式化日期\n    formatDate(dateString) {\n      if (!dateString) return '-'\n      const date = new Date(dateString)\n      return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`\n    },\n    \n    // 获取状态文本\n    getStatusText(status) {\n      switch (status) {\n        case 0: return '待确认'\n        case 1: return '已确认'\n        case 2: return '已完成'\n        case 3: return '已取消'\n        default: return '未知状态'\n      }\n    },\n    \n    // 获取状态类型（用于标签颜色）\n    getStatusType(status) {\n      switch (status) {\n        case 0: return 'warning'\n        case 1: return 'primary'\n        case 2: return 'success'\n        case 3: return 'danger'\n        default: return 'info'\n      }\n    },\n    \n    // 获取支付方式文本\n    getPaymentMethodText() {\n      switch (this.paymentMethod) {\n        case 'wechat': return '微信'\n        case 'alipay': return '支付宝'\n        case 'unionpay': return '银联云闪付'\n        default: return ''\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n.payment-container {\n  height: 100%;\n}\n\n.payment-card {\n  margin-bottom: 20px;\n}\n\n.payment-section {\n  margin-bottom: 30px;\n}\n\n.payment-section h3 {\n  margin-top: 0;\n  padding-bottom: 10px;\n  border-bottom: 1px solid #ebeef5;\n}\n\n.empty-data {\n  text-align: center;\n  padding: 30px 0;\n  color: #909399;\n}\n\n.empty-data i {\n  font-size: 40px;\n  margin-bottom: 10px;\n}\n\n.payment-dialog-content {\n  padding: 0 20px;\n}\n\n.payment-info {\n  margin-bottom: 20px;\n}\n\n.payment-amount {\n  font-size: 18px;\n}\n\n.payment-amount .amount {\n  color: #f56c6c;\n  font-weight: bold;\n}\n\n.payment-method {\n  margin-bottom: 20px;\n}\n\n.payment-qrcode {\n  text-align: center;\n  margin: 20px 0;\n}\n\n.payment-qrcode img {\n  width: 200px;\n  height: 200px;\n  border: 1px solid #dcdfe6;\n}\n\n.text-center {\n  text-align: center;\n}\n\n/* 发票样式 */\n.invoice-content {\n  padding: 20px;\n}\n\n.invoice-header {\n  text-align: center;\n  margin-bottom: 30px;\n}\n\n.invoice-header h2 {\n  margin-bottom: 5px;\n}\n\n.invoice-info {\n  margin-bottom: 30px;\n}\n\n.invoice-row {\n  display: flex;\n  margin-bottom: 10px;\n}\n\n.invoice-label {\n  width: 150px;\n  font-weight: bold;\n}\n\n.invoice-value {\n  flex: 1;\n}\n\n.invoice-table {\n  margin-bottom: 30px;\n}\n\n.invoice-table table {\n  width: 100%;\n  border-collapse: collapse;\n}\n\n.invoice-table th,\n.invoice-table td {\n  border: 1px solid #ddd;\n  padding: 8px;\n  text-align: left;\n}\n\n.invoice-table th {\n  background-color: #f2f2f2;\n}\n\n.invoice-table tfoot td {\n  font-weight: bold;\n}\n\n.text-right {\n  text-align: right;\n}\n\n.invoice-footer {\n  margin-top: 50px;\n}\n\n.invoice-stamp {\n  margin-top: 30px;\n  text-align: right;\n  border: 2px dashed #f00;\n  display: inline-block;\n  padding: 10px 20px;\n  color: #f00;\n  font-weight: bold;\n  float: right;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}